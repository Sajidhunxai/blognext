{%- assign per_row = section.settings.per_row -%}
{%- assign product_limit = per_row | times: section.settings.rows -%}

{%- if section.settings.divider -%}<div class="section--divider">{%- endif -%}

<span class="sm" id="{{ section.settings.title | replace: " ", "-" }}"></span>
<div
  id="CollectionSection-{{ section.id }}"
  data-section-id="{{ section.id }}"
  data-section-type="collection-grid"
  data-context="featured-collection">
  {%- if section.settings.title != blank -%}
    <div class="page-width">
      <div class="section-header">
        <h2 class="section-header__title">
          {% if section.settings.heading_link != blank %}
          <a href="{{ section.settings.heading_link }}">
            {{ section.settings.title }}
          </a>
          {% else %}
            {{ section.settings.title }}
          {% endif %}
        </h2>
        {% if section.settings.sub-title != blank %}
        <p>{{ section.settings.sub-title }}</p>
        {% endif %}
      </div>
    </div>
  {%- endif -%}

  <div class="full-page-width">
    <div{% if section.settings.mobile_scrollable %} class="grid-overflow-wrapper"{% endif %}>
      <div class="grid grid--uniform pd-slider"{% if section.settings.mobile_scrollable %} data-aos="overflow__animation"{% endif %}>
        {%- liquid
          capture gridView
            render 'products_per_row', products_per_row: per_row, style: 'fractions'
          endcapture

          if section.settings.mobile_scrollable
            assign fallback = '39vw'
          else
            assign fallback = 'variable'
          endif
        -%}

        {%- if section.blocks.size == 0 -%}
          {%- unless emptyState -%}
            {%- assign emptyState = true -%}
          {%- endunless -%}
          <div class="grid__item">
            <div class="grid grid--uniform">
              {%- for i in (1..product_limit) -%}
                <div class="grid__item grid-product {{ gridView }}" data-product-available="true">
                  <div class="grid-product__content">
                    <a href="#" class="grid-product__link">
                      <div class="grid-product__image-mask">
                        {%- capture current -%}{% cycle 1, 2, 3, 4, 5, 6 %}{%- endcapture -%}
                        <div class="image-wrap">{{ 'product-' | append: current | placeholder_svg_tag: 'placeholder-svg' }}</div>
                      </div>
                      <div class="grid-product__meta">
                        <div class="grid-product__title">{{ 'home_page.onboarding.product_title' | t }}</div>
                        <div class="grid-product__price">$29</div>
                      </div>
                    </a>
                  </div>
                </div>
              {%- endfor -%}
            </div>
          </div>
        {%- else -%}
          {%- for block in section.blocks -%}
            {%- if block.type == 'product' and block.settings.product != blank -%}
              {%- assign product = all_products[block.settings.product] -%}
              {%- if product != blank -%}
                {%- if product.variants.size > 1 and section.settings.show_variants -%}
                  {%- for variant in product.variants -%}
                    {%- assign hide_variant = variant.metafields.custom.hide_variant -%}
                    {%- if variant.available and hide_variant != true and hide_variant != 'true' -%}
                      {%- render 'custom-variant-grid-item',
                        variant: variant,
                        product: product,
                        per_row: per_row,
                        quick_shop_enable: settings.quick_shop_enable,
                        fallback: fallback
                      -%}
                    {%- endif -%}
                  {%- endfor -%}
                {%- else -%}
                  {%- render 'custom-product-grid-item',
                    product: product,
                    collection: null,
                    per_row: per_row,
                    quick_shop_enable: settings.quick_shop_enable,
                    fallback: fallback
                  -%}
                {%- endif -%}
              {%- endif -%}
            {%- endif -%}
          {%- endfor -%}
        {%- endif -%}



      </div>
    </div>
  </div>
</div>

{%- if section.settings.divider -%}</div>{%- endif -%}


{% comment %} {% if section.settings.hide_unavailable_variants %}
<style>
  .grid-product-{{ section.id }}:not([data-product-available="true"]) {
    display: none !important;
  }
</style>
{% endif %} {% endcomment %}


{%- style -%}
  body.collection-mouthpeaces .grid__item.grid-product[data-product-handle=mouthpeace-filter-roll], body.collection-mouthpeaces .grid__item.grid-product[data-product-handle=mouthpeace-mini], body.collection-mouthpeaces .grid__item.grid-product[data-product-handle=mouthpeace-micro] { display: block; }
{% endstyle %}


{% schema %}
{
  "name": "custom collection",
  "class": "custom-col",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "t:sections.featured-collection.settings.title.label",
      "default": "Featured collection"
    },
    {
      "type": "url",
      "id":"heading_link",
      "label":"Heading URL"
    },
    {
      "type": "text",
      "id": "sub-title",
      "label": "Sub Title"
    },
    {
      "type": "range",
      "id": "per_row",
      "label": "t:sections.featured-collection.settings.per_row.label",
      "default": 4,
      "min": 1,
      "max": 5,
      "step": 1
    },
    {
      "type": "range",
      "id": "rows",
      "label": "t:sections.featured-collection.settings.rows.label",
      "default": 1,
      "min": 1,
      "max": 5,
      "step": 1
    },
    {
      "type": "checkbox",
      "id": "mobile_scrollable",
      "label": "t:sections.featured-collection.settings.mobile_scrollable.label",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "divider",
      "label": "t:sections.featured-collection.settings.divider.label",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "show_variants",
      "label": "Show Product Variants",
      "default": false,
      "info": "If enabled, shows all variants for products with multiple variants"
    },
    {
      "type": "checkbox",
      "id":"v-link",
      "label":"Link with Variant Selected"
    },
    {
      "type": "checkbox",
      "id": "hide_unavailable_variants",
      "label": "Hide Unavailable Variants/Products",
      "default": false
    },
    {
      "type": "url",
      "id":"c-link",
      "label":"Custom Link"
    }
  ],
  "presets": [
    {
      "name": "custom collection"
    }
  ],
  "blocks": [
    {
      "type": "product",
      "name": "Product",
      "settings": [
        {
          "type": "product",
          "id": "product",
          "label": "Product"
        }
      ]
    }
  ],
  "disabled_on": {
    "groups": ["footer", "header", "custom.popups"]
  }
}
{% endschema %}
